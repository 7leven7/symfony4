# Dynamic Form Events

Coming soon...

All right, here's the issue and it is technical. When I originally low this, I have near a star as my location, so I have a choice list of stars. We know that the choice type, if you hack the choice type every retain fields, juice here to earth and it updates. That's not gonna work. It's gonna fail validation because the choice type of smart enough not to allow an invalid choice. The problem is if I change this to the solar system in, then I changed this to earth.

That should work because we're actually changing the type, but it doesn't and this is a problem because in a second we're going to add some some javascript and Ajax so that when we do change the location to the solar system, it's going to update the location name dropdown down to bed list of planets, but in order for that to work, our form system needs to be smart enough to realize at the moment we're submitting that the location has changed and so before it does validation on the choice type, it needs to change the choices to be the list of planets. This doesn't totally make sense yet. Let's see some code, it should help a little bit. So one of the things that you can do with the form system we haven't talked about yet, and it's really complex I don't like having to do it, is it has an event system. So say builder Arrow, get location men say add event listener, and then we're gonna. Use a concept called forum events. Colin Colin Post submit. You know this, this is a little class here that will show you all of the different events that you can listen to you on your form. And then we're going to pass this a call back. I think it's going to use the receive a formal event singular object. And I'm just going to say dd on that event object. All right, so two important things here. First of all

are when you build forms, it's actually a big a form treat. And we've seen this inside of our, uh, form profiler. There's actually a form object on top and then each individual feel below that is itself actually a form object. The same is true with the form builder. We normally are just interact with a top loader builder and adding fields to it, but when you had a,

when you add a field to build are actually grades a builder below it and you can get that builder back out later by saying builder Arrow get. Second thing is we're actually adding the event listener on this, so basically says when the form is submitted, call this callback, but this event object, we'll just have information about the location field. All right, let's just see it so we can figure it out. I'm going to repost the data here and it can pass this big form object in and it actually contains the raw solar system data and it contains the raw form object

which has also has the data on it. So here's the cool thing. This gives us a hook. This happens before, right after we get the form data, but before any of the validation takes place so we can actually dynamically change the specific name of choice type based on the value that was submitted. So to do that, I'm actually going to go down here and create a new private function called set up specific location name field. The job of this function will be to dynamically add the the specific name field with the correct choices. It's gonna, accept a foreign interface. Talk about that in a second and a knowable string location because maybe there isn't a location selected and inside here it's pretty simple. First I'm gonna check to see if that location is no. If it is, I'm going to take the form object and actually remove my specific location, name, field, and then return. So the idea here is if I originally rendered the form and there was a location, then there will then thanks to our logic up here, there will be a specific location name, but if we changed it to be,

if we actually changed it in selected, choose a location, that means we're not choosing a location and we actually want to remove that specific location, name field before we do any of the validation. So that's what I'm doing down here. I'm actually removing it. Next, I'll get the choices by using our get location, name choices and paths, that location, and then I'm gonna. Do something similar. I'm gonna. Say if no is equal to the choices, I'm once again, I'm going to remove the form field and return. What this is doing is it perhaps the user selected interstellar space that doesn't have any choices, and so if there are no choices, let's once again removed the field from the forum and then finally down here we want to add the field, but we want to add using our custom choices. So I'm actually going to go up to the top. I'm going to copy my builder Arrow ad go down here and say form Arrow ad that actually works the same way and then for choices pass it choices.

So we created this new function so that we can call it from inside of our listener. So scroll up a little bit. I'm going to say form equals event. Arrow get form. That gives us the actual form object. We don't normally work at the foreign object directly. We normally you work with this form builder, but they do have some similarities to them. Then I'm going to say this Arrow set up specific location, name field. Remember, this requires two arguments. The form object which is actually going to be form Arrow, get parent. This is super tricky guys. The form object here is actually representing just the location field, but when you want to pass the entire top level form object so that the specific location name field can be added or removed from it. All right? And then the second argument is the location itself, which is going to be form Arrow, get data. You can also use event Arrow get data. There's a subtle difference between those two. Form Arrow, get data is posted. Data transformation, so it uh, it might be a better option. Okay guys, I know that's craziness, but if we go back now and refresh

it saves in to remind you what we just did here. I can now change this to nearest star and then I'll do inspect element on that. Select imagine that. Imagine that when we made that change to actually updated this dropdown. So earth is selected here that's actually go find a valid star name like serious if we hack that in there pretending like it was actually updated and hit update, that's going to change. Yes, that changes our location and our specific location name at the same time, which means we're ready to actually swap out the location name with Ajax when the location changes. First, it's one more thing I want to do and that's to avoid duplication because you'll notice that we are now setting up the location name field in two places. We have our if statement up here, we've basically duplicated that down inside of our setup specific location name field. So let's just call this setup specific location name field from our original builder APP. So when the form is originally rendered, let's, uh, let's call it function to do it. Now, the only problem with that is that when you originally building the forum, we have a form builder objects and for reasons that aren't important down here, we need a. We were receiving a form interface object. It's annoying because they have the same method on it method add, but technically there's sort of incompatible

as long way of saying that I'm going to add this specific location name field and a slightly different way to work around this, so remove the location block. I'm actually going to remove the location equals variable above and basically we can do the same thing we just did a second ago by leveraging, once again form events. The advantage is simply going to be that it's going to allow us to get that form object. So this I'm going to call add event listener. I'm going to do it on the entire form object and we're gonna listen to forum events,

preset the data, so this is what's called right when we set the be original data on the form has nothing to do with submitting. It is entirely. For example, if you look in article admin controller, in the case of our edit action, we pass it in article object internally. When that's set on the form, it calls this preset data event. Once again, this will receive the same form event, object event. Then we can say data equals event Arrow get data that will be the underlying data on our forum which we know in our case is actually going to be an article object or not. In the case of the new form, there is no data. I'll say, if not data, then we're going to do nothing. I don't want to add the field at all, but if there is data then we'll use our setup specific location name field, the same we'll say event Arrow get formed because we're adding an event listener to be top level builder. This will be the top level forums. That's correct, and then I'll say data equals get location or read the location off of the original form. So this is pretty much identical to what we had before with our if statement that used the data off of the options and I normally just read the data off of the options because it's simpler. It's a very simple concept.

Talking about event listeners and preset data is way more complicated and most of the time you don't need it and we're just doing in this case because it allows us to reuse this setup specific location name field in two places, but I'm honestly not that happy about it, so this is a long way of saying we hit enter on the form to to open the edit field. Yes, nearest star is selected and it correctly does the list of stars and if I did change this to the solar system and Hakone Earth, that is going to save as well. So we are finally fully 100 percent ready to do the last step, which is to set up some Ajax to dynamically switch this dropdown based on the location field. That's actually the easiest part with all of this.