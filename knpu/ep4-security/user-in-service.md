# User In Service

Coming soon...

Most of our new fancy account page is filled in, we're just missing the twitter username and we haven't done that because we don't actually have that field on our user class yet, so that's no problem. Move over and run whoever and run bin Console. Make Colon entity to update the user entity and add twitter username. We will make this field knowable in the database so that it's optional. Then run bin Console. Make Colon migration and move over and Oh, look in the migrations directory hoping that new file and Yep, it looks perfect. Move back over and run that migration with doctrine. Migrations. Migrate. 

Excellent. Now that we have the new field, we're going to want to make sure that set on our dummy data, so I'll open up user fixture and up in our first loopier I'll say if this Arrow, faker Arrow, boolean, then we'll set this Arrow faker. Then we'll set user Arrow set username, twitter username. This arrow faker error username. This arrow faker error, boolean returns true or false 50 percent of the time. So this will make approximately half of our users have the twitter username. So move our and run bin Console doctrine, fixtures, load, excellent. And finally we can go to our account slash index dot html dot twig, and we can fill in APP that user dot twitter username, but we probably don't want to show this block if they don't have a twitter user name. So we can also surround that with an if statement and if. Perfect. All right, let's find out which user. Let's find an example of a user that does have a twitter handle. So we'll run bin Console doctrine query sql, select id, twitter username, select star from user, scroll up and it looks like excellent. Spacebar at one at example, dot com. So let's move back over. I'll refresh the page this time. We'll log in as spacebar one at example, dot com. Password engaged by the way we just got logged out because the idea was missing in the database that relates to the user provider. Click sign in and perfect. 

And actually there's one other that we're using the um, there's one other thing on our site that we can update. Now that we have the user data and that's this little dropdown avatar up here, we should make that match our, our robot. So that's easy. 

I'm going to copy the source here for the robot Hash. Then we'll open up and based on age demo that twig, and instead of the pointing to the astronauts profile image, we'll just point to that same Robo Hash. Now if you move over and refresh, it looks perfect, but there is one small thing that I don't like. I'm going to right click and say copy, image, address and paste. You can see that this image is fairly large, not a huge deal, 300 by 300. But that means we're having the users download of pretty big image just to show this little thumbnail. Fortunately 

wrote Hash has a feature where you can say question mark, size equals. And you could say all 100 x 100 and then you get a smaller image. So what I'm going to do is show that version in the upper right corner, but instead of just putting that question mark size equals right here, I think it's time to organize our avatar code a little bit because we're starting to duplicate it instead of our inside of different templates. So we can do here is in our user class, we can just add a custom function, credit functioning called public function. Get avatar. You were out. We of course don't have an Avatar, you were out property, but that's totally fine. I'm gonna. Give us an argument which is optional and this is going to return a string. So then you were out, you were equals, and now paste that and Robo Hash link. Remove the email address and say that this Arrow get email easy enough. Then down below, if a sizes passed in, and we'll add to that url will say that equals sprint f question mark. Size equals percent. The x percent d filling in the size for both of those. So if we pass this function 100 than it will add question marks. Size equals 100 x 100 the bottom or return that you were out. So this is cool because now we can go into our base. That html, 

we can go into our index and instead of this long string here, we're just going to say curly curly app that that Avatar you were out. We can call this like a property because we know behind the scenes twig is going to be smart enough to call, get Avatar, url, copy that lock and then we can go back into base that each month wake because an index, we want to use the full size and based on html to paste, but this time we can actually call this like a function and passing 100. All right, I'll close that tab. Refresh and everything still works and now her image dress over here is a little bit smaller. Beautiful. Alright, there's one other thing I need to mention it quickly and that is how to get the user and a service. We know how to get the user in a template. We know how to get the user from a controller with this Arrow get user, but if you're in a service, this Arrow get user doesn't exist. That's just a controller. Shortcut to show this off, I'm gonna remind you of a feature we built a long time ago. Click on any article that has the word Bacon in it. When you do that, after you do that, click anywhere on the web debug toolbar. To go to the profiler, go to the log section and click on Info and ehrs. You'll see a message they are talking about Bacon. Again, this very important feature comes from our source service markdown helper service. This is our service class that helps us run the 

run the code for a page through markdown parsing, and he'd sit down here and parse if the content of the article, it's not the title, but the content of that article has the word Bacon in it. Then they log a message, so just as a challenge, I want to add some user information about who is currently logged in to this message. If the way to get access to the user object from inside a service is to use a service called security, so at another argument called security, the one from sip security core security, I'll hit enter, go to initialize fields and have that property so that that property is set. Then down below it's a really cool thing about the security class, a hold command or control click into it is that just has two methods on it, get user and the other one which is is granted because remember there's really only two things you can do with security. You can get the user object or you can figure out whether or not the users should have access to something. Since I've more done helper when we can use that user method, but actually I'm going to do in a cool way instead of maybe at a doing string concatenation on the log message to add the user information. I'm actually going to add a second argument to info which is an array pass it a user key. I'm just making that up and say this Arrow, security Arrow get user 

so unrelated to security. All the methods on the logger have two arguments. The first one is the message in the second one as is called a context key. This is an array of any other extra info that you want to include with the log message. So here I just invented a key call user. I'm setting it to the entire user object, so me go and refresh. Now I'll click back into the profiler, go to info and errors, and you see the same message here, but you have a show context button and you'd see the user object in all of its glory. That's pretty sweet. So now I know how to get the user object from everywhere.